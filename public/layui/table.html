<html>
<head>
  <meta charset="utf-8">
  <title>layui</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="./css/layui.css"  media="all">
  <!-- 注意：如果你直接复制所有代码到本地，上述css路径需要改成你本地的 -->
</head>
<body>

<table class="layui-hide" id="test" lay-data="{id: 'idTest'}" lay-filter="test">

</table>
<script type="text/html" id="toolbarDemo">
  <div class="layui-btn-container">
    <button class="layui-btn layui-btn-sm" lay-event="getCheckData">获取选中行数据</button>
  </div>
</script>

<script type="text/html" id="barDemo">
  <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
  <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>

<script src="./layui.js" charset="utf-8"></script>
<!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
<script type="text/html" id="sexTpl">
  {{#  if(d.id%2 === 1){ }}
  <span style="color: #F581B1;">{{ d.id }}</span>
  {{#  } else { }}
  {{ d.id }}
  {{#  } }}
</script>
<script>
  layui.use('table', function(){
    var table = layui.table;

    var ins1 = table.render({
      elem: '#test'
      ,id: 'idTest'
      ,toolbar: '#toolbarDemo'
      ,defaultToolbar: ['filter', 'print', 'exports']
      ,url:'http://mist.cc/index/index/layui'
      ,page: {theme: '#c00'}
      ,limits: [10, 30, 60, 90]
      ,title: "用户表"
      ,height: 360
      // ,skin: 'line' //行边框风格
      // ,even: true //开启隔行背景
      // ,where: {id: 123}
      // ,page: {
      //   page: 1 //重新从第 1 页开始
      // }
      ,cols: [[
        {type:'radio'}
        ,{checkbox: true}
        ,{field:'id',title: 'ID', sort: true, templet: '#sexTpl'}
        ,{field:'name', title: '用户名', edit: 'text'}
        ,{field:'password', title: '密码', sort: true}
        ,{field:'created_at', title: '创建时间'}
        ,{field:'updated_at', title: '更新时间'}
        ,{fixed: 'right', title:'操作', toolbar: '#barDemo',width:120, fixed: 'right'}
      ]]
      ,request: {
        pageName: 'page' //页码的参数名称，默认：page
        ,limitName: 'limit' //每页数据量的参数名，默认：limit
      }
      ,response: {
        statusName: 'code' //规定数据状态的字段名称，默认：code
        ,statusCode: 0 //规定成功的状态码，默认：0
        ,msgName: 'msg' //规定状态信息的字段名称，默认：msg
        ,countName: 'total' //规定数据总数的字段名称，默认：count
        ,dataName: 'data' //规定数据列表的字段名称，默认：data
      }
    });
     // table.exportFile(ins1.config.id, data);

    var checkStatus = table.checkStatus('test'); //idTest 即为基础参数 id 对应的值

    // test 为 lay-filter值
    table.on('checkbox(test)', function(obj){
      // console.log(obj)
    });

    table.on('toolbar(test)', function(obj){
      var checkStatus = table.checkStatus(obj.config.id);
      switch(obj.event){
        case 'add':
          layer.msg('添加');
          break;
        case 'delete':
          layer.msg('删除');
          break;
        case 'update':
          layer.msg('编辑');
          break;
      };
    });

    table.on('checkbox(test)', function(obj){
      console.log(obj.checked); //当前是否选中状态
      console.log(obj.data); //选中行的相关数据
      console.log(obj.type); //如果触发的是全选，则为：all，如果触发的是单选，则为：one
    });

    table.on('toolbar(test)', function(obj){
      var checkStatus = table.checkStatus(obj.config.id); //获取选中行状态
      switch(obj.event){
        case 'getCheckData':
          var data = checkStatus.data;  //获取选中行数据
          layer.alert(JSON.stringify(data));
          break;
      };
    });

    table.on('edit(test)', function(obj){
      var value = obj.value //得到修改后的值
          ,data = obj.data //得到所在行所有键值
          ,field = obj.field; //得到字段
      layer.msg('[ID: '+ data.id +'] ' + field + ' 字段更改为：'+ value);
    });

    //监听行工具事件
    table.on('tool(test)', function(obj){
      var data = obj.data;
      //console.log(obj)
      if(obj.event === 'del'){
        layer.confirm('真的删除行么', function(index){
          obj.del();
          layer.close(index);
        });
      } else if(obj.event === 'edit'){
        layer.prompt({
          formType: 2
          ,value: data.name
        }, function(value, index){
          obj.update({
            email: value
          });
          layer.close(index);
        });
      }
    });
  });

</script>

</body>
</html>