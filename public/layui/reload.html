<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <link rel="stylesheet" href="./css/layui.css"  media="all">
</head>
<body>
<div class="demoTable">
  搜索ID：
  <div class="layui-inline">
    <input class="layui-input" name="id" id="demoReload" autocomplete="off">
  </div>
  <button class="layui-btn" data-type="reload">搜索</button>
</div>

<table class="layui-hide" id="LAY_table_user" lay-filter="user"></table>
<script src="./layui.js" charset="utf-8"></script>
<script>
  layui.use('table', function(){
    var table = layui.table;

    //方法级渲染
    table.render({
      elem: '#LAY_table_user'
      ,url:'http://mist.cc/index/index/layui'
      ,cols: [[
        {checkbox: true, fixed: true}
        ,{field:'id',title: 'ID', sort: true, templet: '#sexTpl'}
        ,{field:'name', title: '用户名', edit: 'text'}
        ,{field:'password', title: '密码', sort: true, event: 'setPassword', style:'cursor: pointer;'}
        ,{field:'created_at', title: '创建时间'}
        ,{field:'updated_at', title: '更新时间'}
      ]]
      ,id: 'testReload'
      ,page: true
      ,height: 310
      ,request: {
        pageName: 'page' //页码的参数名称，默认：page
        ,limitName: 'limit' //每页数据量的参数名，默认：limit
      }
      ,response: {
        statusName: 'code' //规定数据状态的字段名称，默认：code
        ,statusCode: 0 //规定成功的状态码，默认：0
        ,msgName: 'msg' //规定状态信息的字段名称，默认：msg
        ,countName: 'total' //规定数据总数的字段名称，默认：count
        ,dataName: 'data' //规定数据列表的字段名称，默认：data
      }
    });

    var $ = layui.$, active = {
      reload: function(){
        var demoReload = $('#demoReload');

        //执行重载
        table.reload('testReload', {
          page: {
            curr: 1 //重新从第 1 页开始
          }
          ,where: {
            id: demoReload.val()
            // key: {
            //   id: demoReload.val()
            // }
          }
        }, 'data');
      }
    };

    $('.demoTable .layui-btn').on('click', function(){
      var type = $(this).data('type');
      active[type] ? active[type].call(this) : '';
    });

    //监听单元格事件
    table.on('tool(user)', function(obj){
      var data = obj.data;
      if(obj.event === 'setPassword'){
        layer.prompt({
          formType: 2
          ,title: '修改用户 为 ['+ data.name +'] 的用户密码'
          ,value: data.password
        }, function(value, index){
          layer.close(index);

          //这里一般是发送修改的Ajax请求

          //同步更新表格和缓存对应的值
          obj.update({
            password: value
          });
        });
      }
    });
  });
</script>
</body>

</html>